--- gpm-1.19.3/gpn.c.tempfilesecurity	Tue Jul 18 09:06:06 2000
+++ gpm-1.19.3/gpn.c	Wed Jan 10 15:58:35 2001
@@ -223,13 +223,17 @@
 static void
 check_uniqueness(void)
 {
-  static char tmp_pidfile [] = GPM_NODE_DIR "gpmXXXXXX";
+  static char tmp_pidfile [64]; 
+  int fd;
   FILE* fp = 0;
 
-  if (!mktemp(tmp_pidfile + strlen(GPM_NODE_DIR))) {
-    oops("mktemp()");
+  tmp_pidfile[0] = '\0';
+  strncat(tmp_pidfile, GPM_NODE_DIR "gpmXXXXXX", sizeof(tmp_pidfile) - 1);
+
+  if ((fd = mkstemp(tmp_pidfile)) == -1) {
+    oops("mkstemp()");
   } /*if*/
-  if ((fp = fopen(tmp_pidfile,"w")) != NULL) {
+  if ((fp = fdopen(fd,"w")) != NULL) {
     fprintf(fp,"%d\n",getpid());
     fclose(fp);
   } else if (getuid()) {
